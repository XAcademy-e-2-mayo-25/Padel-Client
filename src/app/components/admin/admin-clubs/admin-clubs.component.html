<div class="container py-3 clubs-container">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
    <div>
      <h1 class="fw-bold mb-1">Clubes</h1>
      <p class="text-muted mb-0">Listado completo de clubes. Podés filtrar y cambiar su estado.</p>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary btn-sm" (click)="goBack()">
        <i class="bi bi-arrow-left"></i> Volver al panel
      </button>
      <button class="btn btn-danger btn-sm" (click)="logout()">
        <i class="bi bi-box-arrow-right me-1"></i> Cerrar sesión
      </button>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body d-flex flex-column flex-md-row gap-2 align-items-md-center">
      <div class="flex-grow-1">
        <input type="text" class="form-control" placeholder="Buscar por nombre, CUIT/CUIL o ubicación"
          [(ngModel)]="searchTerm">
      </div>
      <button class="btn btn-outline-primary btn-sm" (click)="loadClubs()">
        <i class="bi bi-arrow-clockwise"></i> Recargar
      </button>
    </div>
  </div>

  <div class="card pending-card">
    <div class="card-header d-flex flex-column flex-md-row justify-content-between align-items-md-center">
      <div>
        <h5 class="mb-1">Clubes</h5>
        <small class="text-muted">Total: {{ filteredClubs.length }}</small>
      </div>
    </div>
    <div class="card-body">
      <div *ngIf="loading" class="text-center text-muted py-3">
        Cargando clubes...
      </div>

      <div *ngIf="error" class="alert alert-danger py-2">
        {{ error }}
      </div>

      <div *ngIf="message" class="alert alert-success py-2">
        {{ message }}
      </div>

      <div *ngIf="!loading && filteredClubs.length === 0 && !error" class="text-muted text-center py-3">
        No hay clubes para mostrar.
      </div>

      <div class="table-responsive" *ngIf="filteredClubs.length > 0">
        <table class="table table-hover pending-table align-middle mb-0">
          <thead>
            <tr>
              <th>Club</th>
              <th>CUIT/CUIL</th>
              <th>Ubicación</th>
              <th>Estado</th>
              <th>Fechas</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let club of filteredClubs">
              <td>
                <div class="fw-semibold">{{ club.nombreFantasia || club.razonSocial || 'Sin nombre' }}</div>
                <small class="text-muted">ID: {{ club.idClub }}</small>
              </td>
              <td>{{ club.cuitCuil }}</td>
              <td>{{ club.localidad }}, {{ club.provincia }}</td>
              <td>
                <span [class]="estadoClass(club.idEstadoClub)">
                  {{ estadoLabel(club.idEstadoClub) }}
                </span>
              </td>
              <td>
                <div class="small text-muted">
                  <div><strong>Solicitud:</strong> {{ formatDate(club.createdAt) }}</div>
                  <div><strong>Último cambio:</strong> {{ formatDate(club.updatedAt) }}</div>
                </div>
              </td>
              <td>
                <div class="d-flex flex-column gap-1">
                  <button class="btn btn-outline-danger btn-sm"
                    [disabled]="actingClubId === club.idClub"
                    (click)="setEstado(club, 3)">
                    <span *ngIf="actingClubId === club.idClub && actingState === 3" class="spinner-border spinner-border-sm me-1"></span>
                    Rechazar
                  </button>
                  <button class="btn btn-outline-secondary btn-sm"
                    [disabled]="actingClubId === club.idClub"
                    (click)="setEstado(club, 1)">
                    <span *ngIf="actingClubId === club.idClub && actingState === 1" class="spinner-border spinner-border-sm me-1"></span>
                    Revertir a pendiente
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
