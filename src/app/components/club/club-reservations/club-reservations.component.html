<div class="dashboard-container p-3 p-md-4">
  <div class="d-flex align-items-center justify-content-between gap-2 mb-3">
    <div>
      <h2 class="dashboard-title mb-0">Reservas del Club</h2>
      <div class="text-muted small" *ngIf="club">
        {{ club.nombreFantasia || club.razonSocial || ('Club #' + club.idClub) }}
      </div>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary btn-sm" (click)="goBack()">Volver</button>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="feedback" class="alert alert-success">{{ feedback }}</div>

  <div class="row g-3">
    <!-- Panel canchas -->
    <div class="col-12 col-lg-4">
      <div class="card h-100">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-bold">Canchas</div>
              <div class="small text-muted">Seleccioná una cancha para ver su calendario</div>
            </div>
            <div class="small text-muted" *ngIf="cargandoClub || cargandoCanchas">
              Cargando...
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="alert alert-warning mb-0" *ngIf="!cargandoCanchas && canchas.length === 0">
            Este club no tiene canchas registradas.
          </div>

          <div class="list-group" *ngIf="canchas.length > 0">
            <button
              type="button"
              class="list-group-item list-group-item-action"
              [class.is-selected]="selectedCancha?.idCancha === c.idCancha"
              *ngFor="let c of canchas"
              (click)="verReservasDeCancha(c)"
            >
              <div class="d-flex justify-content-between align-items-center">
                <div class="fw-bold">{{ c.denominacion }}</div>
                <span class="badge bg-light text-dark">{{ c.cubierta ? 'Cubierta' : 'Descubierta' }}</span>
              </div>

              <div class="small text-muted mt-1">
                Días: {{ formatDiasSemana(c.diasSemana) }}
              </div>
              <div class="small text-muted">
                Horario: {{ (c.horaDesde || '--:--') }} - {{ (c.horaHasta || '--:--') }} · Slot: {{ c.rangoSlotMinutos || 60 }}'
              </div>
              <div class="small text-muted">
                Precio: $ {{ c.precio ?? 0 }}
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendario + listado reservas -->
    <div class="col-12 col-lg-8">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-bold">Calendario</div>
            <div class="small text-muted" *ngIf="selectedCancha">
              {{ selectedCancha.denominacion }} · Ocupados en rojo
            </div>
            <div class="small text-muted" *ngIf="!selectedCancha">
              Seleccioná una cancha para ver el calendario.
            </div>
          </div>

          <div class="small text-muted" *ngIf="cargandoReservas">
            Cargando reservas...
          </div>
        </div>

        <div class="card-body" *ngIf="selectedCancha; else emptyState">
          <full-calendar [options]="calendarOptions"></full-calendar>

          <hr class="my-3" />

          <div class="d-flex align-items-center justify-content-between mb-2">
            <h6 class="mb-0">Reservas de la semana (cancha seleccionada)</h6>
            <span class="text-muted small">Total: {{ reservas.length }}</span>
          </div>

          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Fecha</th>
                  <th>Usuario</th>
                  <th>Horario</th>
                  <th>Monto</th>
                  <th>Estado</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngIf="reservas.length === 0">
                  <td colspan="6" class="text-muted">No hay reservas en el rango visible.</td>
                </tr>

                <tr *ngFor="let r of reservas">
                  <td class="fw-bold">{{ reservaCodigo(r) }}</td>
                  <td>{{ r.fecha }}</td>
                  <td>{{ reservaUsuarioLabel(r) }}</td>
                  <td>{{ reservaHorarioLabel(r) }}</td>
                  <td>{{ reservaMonto(r) }}</td>
                  <td>
                    <span [class]="reservaEstadoLabel(r).badge">
                      {{ reservaEstadoLabel(r).text }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="text-muted small mt-2">
            Nota: “CANCELADA” significa <strong>pagado=false</strong>
          </div>
        </div>

        <ng-template #emptyState>
          <div class="card-body">
            <div class="text-muted">
              Seleccioná una cancha para ver el calendario de reservas.
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
